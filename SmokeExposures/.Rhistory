domain = na.exclude(foo2$medium)
)
pal_h <- colorBin(
palette =  "Reds",
bins = 7,
domain = na.exclude(foo2$heavy)
)
mapTemp <- CAtracts %>% inner_join(foo2)
mapTemp%>%
leaflet()  %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_l(light),
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE),
popup = paste0("Since Jan 29, 2018 this tract has experienced ",mapTemp$light," days (",round(100*maptemp$light/199,1),"%) of Light Smoke Exposure."),
group="Light Smoke") %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_m(medium),
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE),
popup = paste0("Since Jan 29, 2018 this tract has experienced ",mapTemp$medium," days (",round(100*maptemp$medium/199,1),"%) of Medium Smoke Exposure."),
group="Medium Smoke") %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_h(heavy),
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE),
popup = paste0("Since Jan 29, 2018 this tract has experienced ",mapTemp$heavy," days (",round(100*maptemp$heavy/199,1),"%) of Heavy Smoke Exposure."),
group="Heavy Smoke") %>%
addLayersControl(
baseGroups = c("Heavy Smoke", "Medium Smoke", "Light Smoke"),
options = layersControlOptions(collapsed = TRUE)
)
mapTemp <- CAtracts %>% inner_join(foo2)
mapTemp %>%
leaflet()  %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_l(light),
highlightOptions = highlightOptions(
color = "white",
weight = 2,
bringToFront = TRUE
),
popup = paste0(
"Since Jan 29, 2018 this tract has experienced ",
mapTemp$light,
" days (",
round(100 * maptemp$light / 199, 1),
"%) of Light Smoke Exposure."
),
group = "Light Smoke"
) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_m(medium),
highlightOptions = highlightOptions(
color = "white",
weight = 2,
bringToFront = TRUE
),
popup = paste0(
"Since Jan 29, 2018 this tract has experienced ",
mapTemp$medium,
" days (",
round(100 * maptemp$medium / 199, 1),
"%) of Medium Smoke Exposure."
),
group = "Medium Smoke"
) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_h(heavy),
highlightOptions = highlightOptions(
color = "white",
weight = 2,
bringToFront = TRUE
),
popup = paste0(
"Since Jan 29, 2018 this tract has experienced ",
mapTemp$heavy,
" days (",
round(100 * maptemp$heavy / 199, 1),
"%) of Heavy Smoke Exposure."
),
group = "Heavy Smoke"
) %>%
addLayersControl(
baseGroups = c("Heavy Smoke", "Medium Smoke", "Light Smoke"),
options = layersControlOptions(collapsed = TRUE)
)
mapTemp %>%
leaflet()  %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_l(light),
highlightOptions = highlightOptions(
color = "white",
weight = 2,
bringToFront = TRUE
),
popup = paste0(
"Since Jan 29, 2018 this tract has experienced ",
mapTemp$light,
" days (",
round(100 * mapTemp$light / 199, 1),
"%) of Light Smoke Exposure."
),
group = "Light Smoke"
) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_m(medium),
highlightOptions = highlightOptions(
color = "white",
weight = 2,
bringToFront = TRUE
),
popup = paste0(
"Since Jan 29, 2018 this tract has experienced ",
mapTemp$medium,
" days (",
round(100 * mapTemp$medium / 199, 1),
"%) of Medium Smoke Exposure."
),
group = "Medium Smoke"
) %>%
addPolygons(
color = "#444444",
weight = 1,
smoothFactor = 0.1,
fillOpacity = 0.6,
fillColor = ~ pal_h(heavy),
highlightOptions = highlightOptions(
color = "white",
weight = 2,
bringToFront = TRUE
),
popup = paste0(
"Since Jan 29, 2018 this tract has experienced ",
mapTemp$heavy,
" days (",
round(100 * mapTemp$heavy / 199, 1),
"%) of Heavy Smoke Exposure."
),
group = "Heavy Smoke"
) %>%
addLayersControl(
baseGroups = c("Heavy Smoke", "Medium Smoke", "Light Smoke"),
options = layersControlOptions(collapsed = TRUE)
)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F)
View(children)
names(children)
head(children)
saveRDS(foo2,file = "~/GitHub/WFSmokeExp/SmokeExposures/Jan29ToAug152018_wide.rds")
runApp('GitHub/WFSmokeExp/SmokeExposures')
runApp('GitHub/WFSmokeExp/SmokeExposures')
runApp('GitHub/WFSmokeExp/SmokeExposures')
runApp('GitHub/WFSmokeExp/SmokeExposures')
runApp('GitHub/WFSmokeExp/SmokeExposures')
View(children)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F)
names(children)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numeratr, race) %>%
spread(key = race, value = numeratr)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numeratr, race) %>%
spread(key = race, value = numeratr)
read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numeratr, race) %>%
spread(key = race, value = numeratr)
read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numeratr, race) %>%
spread(key = race, value = numeratr)
read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numeratr, race)
read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_education_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv)
View(elderly)
insurance <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_insurance_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv)
View(foo2)
View(insurance)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
filter(race == "Total")
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
filter(race == "Total") %>%
select(geotypv, numratr, denmntr) %>%
rename(ct10 = geotypv,
children = numratr,
population = denmntr)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_education_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv,
elderly = Total)
View(children)
View(elderly)
View(insurance)
View(elderly)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv,
elderly = Total)
View(elderly)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
spread(key = race, value = numratr) %>%
rename(ct10 = geotypv)
View(children)
View(elderly)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
rename(ct10 = geotypv)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
rename(ct10 = geotypv)
insurance <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_insurance_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race) %>%
rename(ct10 = geotypv)
View(insurance)
View(elderly)
View(children)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, race, denmntr) %>%
rename(ct10 = geotypv)
View(elderly)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
elderly = numratr,
population = denmntr)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
elderly = numratr,
population = denmntr)
View(elderly)
runApp('GitHub/WFSmokeExp/SmokeExposures')
runApp('GitHub/WFSmokeExp/SmokeExposures')
View(children)
View(elderly)
runApp('GitHub/WFSmokeExp/SmokeExposures')
vuln <- ininner_join(children, elderly)
vuln <- inner_join(children, elderly)
View(vuln)
View(children)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
children = numratr,
population = denmntr)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
elderly = numratr,
population = denmntr)
vuln <- inner_join(children, elderly)
View(vuln)
vuln <- inner_join(children, elderly) %>% gather(children, elderly, total, key = cohort, value = population)
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
children = numratr,
total = denmntr)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
elderly = numratr,
total = denmntr)
vuln <- inner_join(children, elderly) %>% gather(children, elderly, total, key = cohort, value = population)
View(vuln)
vuln <- inner_join(children, elderly) %>% gather(children, elderly, total, key = cohort, value = population) %>% saveRDS("~/GitHub/WFSmokeExp/SmokeExposures/vuln.rds")
vuln <- readRDS("vuln.rds")
runApp('GitHub/WFSmokeExp/SmokeExposures')
vuln <- inner_join(children, elderly) %>% gather(children, elderly, total, key = cohort, value = population)
vuln %>% filter(cohort != "total")
View(foo2)
smokeDays <- foo2 %>% select(ct10, heavy)
vuln %>% filter(cohort != "total") %>% inner_join(smokeDays)
View(smokeDays)
View(children)
smokeDays <- foo2 %>% select(ct10, heavy) %>% mutate(ct10 = as.numeric(ct10))
vuln %>% filter(cohort != "total") %>% inner_join(smokeDays)
vuln %>% filter(cohort != "total") %>% inner_join(foo2) %>%
ggplot(aes(x= ))
vuln %>% filter(cohort != "total") %>% inner_join({mutate(foo2, ct10 = as.numeric(ct10))})
names(vuln)
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy)
ggplot(aes(x=cohort, y= heavyPD, fill = race )) + geom_bar(stat="identity")
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy)
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity")
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total") %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity")
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total") %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity")
ggployly(plot)
library(plotly)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total") %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity")
ggplotly(plot)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total") %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity", position="dodge")
ggplotly(plot)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity")
ggplotly(plot)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(HeavyPD = sum(heavyPD),
MediumPD = sum(mediumPD),
LightPD = sum(lightPD))
View(plot)
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Meduim, Light, key = SmokeDensity, value = PersonDays
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Meduim, Light, key = SmokeDensity, value = PersonDays)
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Meduim, Light, key = SmokeDensity, value = PersonDays)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Medium, Light, key = SmokeDensity, value = PersonDays) %>%
ggplot(aes(x=cohort, y= heavyPD, fill = race)) + geom_bar(stat="identity")
vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Medium, Light, key = SmokeDensity, value = PersonDays)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Medium, Light, key = SmokeDensity, value = PersonDays) %>%
ggplot(aes(x=SmokeDensity, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(cohort~.)
ggplotly(plot)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Medium, Light, key = SmokeDensity, value = PersonDays) %>%
ggplot(aes(x=cohort, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(SmokeDensity~.)
ggplotly(plot)
plot <- vuln %>%
inner_join({mutate(foo2, ct10 = as.numeric(ct10))}) %>%
mutate(lightPD = population * light,
mediumPD = population * medium,
heavyPD = population * heavy) %>%
filter(cohort != "total", race != "Total") %>%
group_by(cohort, race) %>%
summarize(Heavy = sum(heavyPD),
Medium = sum(mediumPD),
Light = sum(lightPD)) %>% ungroup() %>%
gather(Heavy, Medium, Light, key = SmokeDensity, value = PersonDays)
plot %>% ggplot(aes(x=cohort, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(.~SmokeDensity~.)
plot %>% ggplot(aes(x=SmokeDensity, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(.~cohort~.)
%>%
plot %>% ggplot(aes(x=cohort, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(.~SmokeDensity~.)
plot %>% ggplot(aes(x=cohort, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(.~SmokeDensity~., scales="free-y")
plot %>% ggplot(aes(x=cohort, y= PersonDays, fill = race)) + geom_bar(stat="identity") + facet_grid(.~SmokeDensity~., scales="free_y")
plot %>% ggplot(aes(x=race, y= PersonDays, fill = SmokeDensity)) + geom_bar(stat="identity") + facet_grid(.~race~., scales="free_y")
plot %>% ggplot(aes(x=race, y= PersonDays, fill = SmokeDensity)) + geom_bar(stat="identity") + facet_grid(.~cohort~., scales="free_y")
plot %>% ggplot(aes(x=race, y= PersonDays, fill = cohort)) + geom_bar(stat="identity") + facet_grid(.~SmokeDensity~., scales="free_y")
runApp('GitHub/WFSmokeExp/SmokeExposures')
install.packages("BH")
runApp('GitHub/WFSmokeExp/SmokeExposures')
