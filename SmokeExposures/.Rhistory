time = sapply(str_split(Description, pattern = " "),"[",6))
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
View(SmkLt)
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkLit
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6),
year = substr(date, 1, 4))
View(SmkLt)
View(SmkLit)
View(SmkLit)
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkMed <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Medium)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkHvy<- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Heavy)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkMed <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Medium)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkHvy<- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Heavy)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
tracts <-  st_read(dsn = "~/CHVI_copy/CHVizArchive/CCHVIz/tracts.GeoJSON", stringsAsFactors = F) %>% st_transform(crs = 4326) %>%
mutate(COUNTYFI_1 = as.character(paste0(STATE, COUNTY)))
testLit <- st_intersection(tracts, SmkLit) %>%
mutate(smoke = "light")
testMed <- st_intersection(tracts, SmkMed) %>%
mutate(smoke = "medium")
testHvy <- st_intersection(tracts, SmkHvy) %>%
mutate(smoke = "heavy")
plot(testHvy)
plot(testMed)
library(tidyverse)
library(sf)
st_layers(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml")
SmkLit <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Light)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkMed <- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Medium)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
SmkHvy<- st_read(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml", layer = "Smoke (Heavy)") %>%
mutate(date = sapply(str_split(Description, pattern = " "),"[",5),
time = sapply(str_split(Description, pattern = " "),"[",6))
# st_layers(dsn = "C:/Users/jvargo/Downloads/latestsmoke.kml")
head(SmkLit)
unique(SmkLit$Description)
tracts <-  st_read(dsn = "~/CHVI_copy/CHVizArchive/CCHVIz/tracts.GeoJSON", stringsAsFactors = F) %>% st_transform(crs = 4326) %>%
mutate(COUNTYFI_1 = as.character(paste0(STATE, COUNTY)))
testLit <- st_intersection(tracts, SmkLit) %>%
mutate(smoke = "light")
testMed <- st_intersection(tracts, SmkMed) %>%
mutate(smoke = "medium")
testHvy <- st_intersection(tracts, SmkHvy) %>%
mutate(smoke = "heavy")
plot(SmkHvy)
plot(SmkMed)
plot(SmkLit)
shiny::runApp('GitHub/WFSmokeExp/SmokeExposures')
dateList <- format(seq(as.Date("2018/08/16"),as.Date("2018/08/20"), by = "day"),"%Y%m%d")
# smokeFileZip <- "http://satepsanone.nesdis.noaa.gov/pub/FIRE/HMS/GIS/ARCHIVE/hms_smoke20180808.zip"
CAtracts <-  st_read(dsn = "~/GitHub/WFSmokeExp/SmokeExposures/tractsSM.GeoJSON", stringsAsFactors = F) %>% st_transform(crs = 4326) %>%
mutate(COUNTYFI_1 = as.character(paste0(STATE, COUNTY)))
smokeDay <- function(HMSday){
year <- substr(HMSday, 1,4)
month <- substr(HMSday, 5,6)
day <- substr(HMSday, 7,8)
smokeFileName <- paste0("http://satepsanone.nesdis.noaa.gov/pub/FIRE/HMS/KML/ARCHIVE/smoke",HMSday,".kml")
layers <- st_layers(smokeFileName)$name
for(l in 1: length(layers)){
Smk <- st_read(dsn = smokeFileName, layer = layers[l]) %>%
mutate(year = year,
month = month,
day = day,
date = paste0(year, month, day),
smoke = layers[l])
SmkLayerDayInt <- st_intersection(Smk, CAtracts)
st_geometry(SmkLayerDayInt) <- NULL
# Smk <-Smk %>% select(date, year, month, day, smoke, ct10) %>%
if(exists("singleDay")){
singleDay <- rbind(singleDay, SmkLayerDayInt)
}
else{
singleDay <- SmkLayerDayInt
}
}
return(singleDay)
}
for (day in dateList){
oneDay <- smokeDay(HMSday = day)
if(exists("AllDays")){
AllDays <- rbind(AllDays, oneDay)
}
else{
AllDays <- oneDay
}
}
saveRDS(AllDays,file = "~/GitHub/WFSmokeExp/Aug16ToAug202018.rds")
temp1 <- bind_rows(readRDS("~/GitHub/WFSmokeExp/Jan29ToAug152018_2.rds"), readRDS("~/GitHub/WFSmokeExp/Aug16ToAug202018.rds"))
saveRDS(temp1,file = "~/GitHub/WFSmokeExp/Jan29ToAug202018.rds")
View(temp1)
AllData <- readRDS(file = "~/GitHub/WFSmokeExp/Jan29ToAug202018.rds") %>%
mutate(date = as.Date(paste0(year, month, day), format= "%Y%m%d"))
length(seq(as.Date("2018/08/13"),as.Date("2018/08/14"), by = "day"))
SmokeByDay <-
AllData %>%
# filter(
#   as.Date(date) >= as.character(dateList[1]) &
#     as.Date(date) <= as.character(dateList[2])
# ) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
select(smoke, ct10, date) %>% inner_join({
vuln %>%
mutate(ct10 = paste0("0",as.character(as.numeric(ct10)))) %>%
filter(race == "Total") %>%
spread(key = cohort, value = population) %>%
select(-race, )
}) %>%
group_by(ct10, date, smoke) %>%
summarize(Persons = mean(total, na.rm=T)) %>%
group_by(smoke, date) %>%
summarize(Persons = sum(Persons, na.rm=T))
vuln <- inner_join(children, elderly) %>%
mutate(other = total - children - elderly) %>%
gather(children, elderly, other, total, key = cohort, value = population) %>%
saveRDS("~/GitHub/WFSmokeExp/SmokeExposures/vuln.rds")
children <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_children_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
children = numratr,
total = denmntr)
elderly <- read.csv("~/CHVI_copy/data/tables/tracts/CHVI_elderly_tract.csv", header = T, stringsAsFactors = F) %>%
select(geotypv, numratr, denmntr, race) %>%
rename(ct10 = geotypv,
elderly = numratr,
total = denmntr)
vuln <- inner_join(children, elderly) %>%
mutate(other = total - children - elderly) %>%
gather(children, elderly, other, total, key = cohort, value = population) %>%
saveRDS("~/GitHub/WFSmokeExp/SmokeExposures/vuln.rds")
SmokeByDay <-
AllData %>%
# filter(
#   as.Date(date) >= as.character(dateList[1]) &
#     as.Date(date) <= as.character(dateList[2])
# ) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
select(smoke, ct10, date) %>% inner_join({
vuln %>%
mutate(ct10 = paste0("0",as.character(as.numeric(ct10)))) %>%
filter(race == "Total") %>%
spread(key = cohort, value = population) %>%
select(-race, )
}) %>%
group_by(ct10, date, smoke) %>%
summarize(Persons = mean(total, na.rm=T)) %>%
group_by(smoke, date) %>%
summarize(Persons = sum(Persons, na.rm=T))
names(AllData)
SmokeByDay <-
AllData %>%
# filter(
#   as.Date(date) >= as.character(dateList[1]) &
#     as.Date(date) <= as.character(dateList[2])
# ) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy")))
vuln %>%
mutate(ct10 = paste0("0",as.character(as.numeric(ct10)))) %>%
filter(race == "Total") %>%
spread(key = cohort, value = population) %>%
select(-race, )
vuln <- inner_join(children, elderly) %>%
mutate(other = total - children - elderly) %>%
gather(children, elderly, other, total, key = cohort, value = population)
SmokeByDay <-
AllData %>%
# filter(
#   as.Date(date) >= as.character(dateList[1]) &
#     as.Date(date) <= as.character(dateList[2])
# ) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
select(smoke, ct10, date) %>% inner_join({
vuln %>%
mutate(ct10 = paste0("0",as.character(as.numeric(ct10)))) %>%
filter(race == "Total") %>%
spread(key = cohort, value = population) %>%
select(-race, )
}) %>%
group_by(ct10, date, smoke) %>%
summarize(Persons = mean(total, na.rm=T)) %>%
group_by(smoke, date) %>%
summarize(Persons = sum(Persons, na.rm=T))
SmokeByDay %>% ggplot(aes(x = date, y= Persons/1000000, fill = smoke)) + geom_area(position = "dodge") + ylab("Millions of People \n (Pop of CA shown dashed)") + xlab("Date") + geom_hline(yintercept = 37.25, color = "red", linetype="dashed")
max(SmokeByDay$date)
SmokeByDay %>% ggplot() +
geom_area(aes(x = date, y= Persons/1000000, fill = smoke), position = "dodge") +
ylab("Millions of People") + xlab("Date") +
geom_hline(yintercept = 37.25, color = "red", linetype="dashed") +
geom_label(aes(x = as.Date("2018-05-01"),y = 37.25, label="Total CA Population")) +
geom_vline(xintercept = as.Date("2018-07-27"), color = "gray20", linetype="twodash") +
geom_label(aes(x = as.Date("2018-07-27"),y = 35, label="Mendocino Complex Start", hjust="right")) +
geom_vline(xintercept = as.Date("2018-07-23"), color = "gray20", linetype="dotdash") +
geom_label(aes(x = as.Date("2018-07-23"),y = 32, label="Carr Fire Start", hjust="right")) +
geom_vline(xintercept = as.Date("2018-07-13"), color = "gray20", linetype="longdash") +
geom_label(aes(x = as.Date("2018-07-13"),y = 29, label="Ferguson Fire Start", hjust="right"))
SmokeByDay %>% ggplot() +
geom_area(aes(x = date, y= Persons/1000000, fill = smoke), position = "dodge") +
ylab("Millions of People") + xlab("Date") +
geom_hline(yintercept = 37.25, color = "red", linetype="dashed") +
geom_label(aes(x = as.Date("2018-05-01"),y = 37.25, label="Total CA Population")) +
geom_vline(xintercept = as.Date("2018-07-27"), color = "gray20", linetype="twodash") +
geom_label(aes(x = as.Date("2018-07-27"),y = 35, label="Mendocino Complex Start", hjust="right")) +
geom_vline(xintercept = as.Date("2018-07-23"), color = "gray20", linetype="dotdash") +
geom_label(aes(x = as.Date("2018-07-23"),y = 32, label="Carr Fire Start", hjust="right")) +
geom_vline(xintercept = as.Date("2018-07-13"), color = "gray20", linetype="longdash") +
geom_label(aes(x = as.Date("2018-07-13"),y = 29, label="Ferguson Fire Start", hjust="right"))
k
SmokeByDay %>% ggplot() +
geom_area(aes(x = date, y= Persons/1000000, fill = smoke), position = "dodge") +
ylab("Millions of People") + xlab("Date") +
geom_hline(yintercept = 37.25, color = "red", linetype="dashed") +
geom_label(aes(x = as.Date("2018-05-01"),y = 37.25, label="Total CA Population")) +
geom_vline(xintercept = as.Date("2018-07-27"), color = "gray20", linetype="twodash") +
geom_label(aes(x = as.Date("2018-07-27"),y = 35, label="Mendocino Complex Start", hjust="right")) +
geom_vline(xintercept = as.Date("2018-07-23"), color = "gray20", linetype="dotdash") +
geom_label(aes(x = as.Date("2018-07-23"),y = 32, label="Carr Fire Start", hjust="right")) +
geom_vline(xintercept = as.Date("2018-07-13"), color = "gray20", linetype="longdash") +
geom_label(aes(x = as.Date("2018-07-13"),y = 29, label="Ferguson Fire Start", hjust="right"))
saveRDS(SmokeByDay, "~/GitHub/WFSmokeExp/SmokeExposures/SmokeByDay.RDS")
runApp('GitHub/WFSmokeExp/SmokeExposures')
max(dateList)
max(dateList)-14
dateList[length(dateList)-14]
length(dateList)-14
dateList <- format(seq(as.Date("2018/01/29"),as.Date("2018/08/20"), by = "day"),"%Y%m%d")
dateList[length(dateList)-14]
AllData %>%
filter(
as.Date(date) >= as.character(dateList[length(dateList)-14]) &
as.Date(date) <= as.character(max(dateList))
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
AllData %>%
filter(
as.Date(date) >= as.character(dateList[length(dateList)-14]) &
as.Date(date) <= as.character(max(dateList))
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
View(AllData)
AllData %>%
filter(
as.Date(date) >= as.character(dateList[length(dateList)-14]) &
as.Date(date) <= as.character(max(dateList))
)
View(AllData)
max(dateList)
max(AllData$date)
AllData %>%
filter(
as.Date(date) >= as.character(dateList[length(dateList)-14]) &
as.Date(date) <= as.character(max(dateList))
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
as.character(max(dateList))
as.character(dateList[length(dateList)-14])
dateList2 <- c(as.Date("2018-08-12"), as.Date("2018-08-13"))
AllData %>%
filter(
as.Date(date) >= dateList[length(dateList)-14] &
as.Date(date) <= max(dateList)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
AllData %>%
filter(
as.Date(date) >= dateList[length(dateList)-14] &
as.Date(date) <= max(dateList)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
AllData %>%
filter(
as.Date(date) >= as.character(as.Date(dateList[length(dateList)-14])) &
as.Date(date) <= as.character(as.Date(max(dateList)))
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
SmokeDaysByTract <-
AllData %>%
filter(
as.Date(date) >= as.character(dateList2[1]) &
as.Date(date) <= as.character(dateList2[2])
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays)
AllData %>%
filter(
as.Date(date) >= as.character(dateList[length(dateList)-14]) &
as.Date(date) <= as.character(dateList[length(dateList)]))
as.character(dateList[length(dateList)])
SmokeDaysByTract <-
AllData %>%
filter(
as.Date(date) >= as.character(dateList2[1]) &
as.Date(date) <= as.character(dateList2[2])
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays)
View(SmokeDaysByTract)
start <- as.Date(dateList[length(dateList)])
start <- as.Date(dateList[length(dateList)],"%Y%m%d" )
end <- as.Date(dateList[length(dateList) - 14],"%Y%m%d")
start <- as.Date(dateList[length(dateList)-14],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) >= as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
AllData %>%
filter(
as.Date(date) >= as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last30days.RDS")
AllData %>%
filter(
as.Date(date) >= as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2months.RDS")
runApp('GitHub/WFSmokeExp/SmokeExposures')
start <- as.Date(dateList[length(dateList)-14],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
)
test <-  AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
)
length(unique(test$date))
start <- as.Date(dateList[length(dateList)-14],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2weeks.RDS")
################ create last 30 days table #################
start <- as.Date(dateList[length(dateList)-30],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last30days.RDS")
################ create last 2 months table #################
start <- as.Date(dateList[length(dateList)-60],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last2months.RDS")
runApp('GitHub/WFSmokeExp/SmokeExposures')
start <- as.Date(dateList[length(dateList)-30],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/last30days.RDS")
start <- as.Date(dateList[length(dateList)-14],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/SmokeExposures/last2weeks.RDS")
################ create last 30 days table #################
start <- as.Date(dateList[length(dateList)-30],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/SmokeExposures/last30days.RDS")
################ create last 2 months table #################
start <- as.Date(dateList[length(dateList)-60],"%Y%m%d")
end <- as.Date(dateList[length(dateList)],"%Y%m%d")
AllData %>%
filter(
as.Date(date) > as.character(start) &
as.Date(date) <= as.character(end)
) %>%
mutate(smoke = factor(ifelse(smoke == "Smoke (Light)", "light",
ifelse(smoke == "Smoke (Heavy)","heavy", "medium")), levels=c("light","medium","heavy"))) %>%
group_by(smoke, ct10) %>%
summarize(NumberOfDays = length(unique(date))) %>%
ungroup() %>%
spread(key = smoke,value = NumberOfDays) %>% saveRDS("~/GitHub/WFSmokeExp/SmokeExposures/last2months.RDS")
runApp('GitHub/WFSmokeExp/SmokeExposures')
